name: Publish schemas to registry

on:
  push:
    branches:
      - write-schemas-in-ci

jobs:
  deploy-schemas:
   runs-on: ubuntu-latest
   permissions:
    contents: read
    id-token: write

  steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Auth to GCP
      uses: google-github-actions/auth@v0
      with:
        credentials_json: ${{ secrets.HONEYPOT_CI_CREDENTIALS }}

    - name: Upload schemas
      uses: google-github-actions/upload-cloud-storage@v0
      with:
        path: schemas
        destination: silverton-schemas
